<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MyFatoorah Card View Payment - Production</title>

    <!-- Production Environment for Kuwait -->
    <script src="https://kw.myfatoorah.com/cardview/v3/session.js"></script>
    <!-- For Egypt, use: https://eg.myfatoorah.com/cardview/v3/session.js -->
</head>

<body style="font-family: Arial; max-width: 450px; margin: auto; padding-top: 30px;">

    <h2>Pay with Card</h2>

    <!-- Card View Container -->
    <div id="card-element" style="margin-bottom: 20px;"></div>

    <!-- Button -->
    <button onclick="submitPayment()" 
            style="padding: 12px 20px; font-size: 16px; cursor: pointer;">
        Pay Now
    </button>

    <script>
        // 1️⃣ Card View Configuration
        var config = {
            countryCode: "KWT", // Your merchant account country
            sessionId: "<98fbdbd2-55c8-40eb-b0ef-8d5afc3de9f3", // Replace with SessionId from live InitiateSession API
            cardViewId: "card-element",
            supportedNetworks: "v,m,md,ae" // Visa, Mastercard, Mada, American Express
        };

        // 2️⃣ Initialize Card View
        myFatoorah.init(config);

        // 3️⃣ Submit Payment
        function submitPayment() {
            myFatoorah.submit()
                .then(function (response) {
                    console.log("Payment success response:", response);

                    var sessionId = response.sessionId; // Send this to backend
                    var cardInfo = response.card;

                    alert("Card Validated Successfully. Now call ExecutePayment from your backend.");

                    // ✅ Call your backend to execute payment
                    fetch("/api/payments/execute", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ sessionId: sessionId })
                    })
                    .then(res => res.json())
                    .then(data => console.log("ExecutePayment response:", data))
                    .catch(err => console.error("Error executing payment:", err));
                })
                .catch(function (error) {
                    console.log("Payment error:", error);
                    alert("Error: " + error.message);
                });
        }
    </script>

</body>
</html>

